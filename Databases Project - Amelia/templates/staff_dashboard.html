{% extends "base.html" %}
{% block content %}

<style>
.dashboard-header {
    text-align: center;
    margin-bottom: 30px;
}



.dashboard-sections {
    display: flex;
    flex-direction: column;
    gap: 30px;
}

.dashboard-card {
    background: rgba(255, 255, 255, 0.7);
    padding: 25px 30px;
    margin: 0 auto;
    width: 85%;
    border-radius: 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
}

.dashboard-card h2 {
    text-align: center;
    margin-bottom: 15px;
    
}

label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
}

input, select {
    width: 100%;
    padding: 8px;
    border-radius: 10px;
    border: 1px solid #ccc;
    margin-top: 3px;
    box-sizing: border-box; 
}

.btn {
    margin-top: 15px;
    display: inline-block;
    padding: 10px 20px;
    border-radius: 12px;
    background-color: #E58A5C;
    color: white;
    border: none;
    text-align: center;
    cursor: pointer;
    text-decoration: none;
}

.btn-small {
    padding: 6px 12px;
    font-size: 14px;
}

.btn-view {
    padding: 6px 12px;
    background-color: #E58A5C;
    color: white;
    text-decoration: none;
    border-radius: 12px;
    font-size: 13px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    transition: 0.2s;
}
.btn-view:hover {
    background-color: #d37448;
    transform: translateY(-2px);
}

.table-scroll {
    max-height: 300px;     
    overflow-y: auto;
    border-radius: 12px;   /* round container edges */
}


.styled-table {
    width: 100%;
    border-collapse: separate; /* required */
    border-spacing: 0;         /* required */
}

.styled-table thead th:first-child {
    border-top-left-radius: 12px;
}

.styled-table thead th:last-child {
    border-top-right-radius: 12px;
}

.styled-table tbody tr:last-child td:first-child {
    border-bottom-left-radius: 12px;
}

.styled-table tbody tr:last-child td:last-child {
    border-bottom-right-radius: 12px;
}


.styled-table th, .styled-table td {
    padding: 10px;
    text-align: center;
}

.styled-table tr:nth-child(even) {
    background-color: #f8f8f8;
}
</style>
{% if error_message %}
<div style="
    background-color: #ffcccc;
    color: #8a0000;
    padding: 12px;
    text-align: center;
    border-radius: 12px;
    font-weight: bold;
    margin: 0 auto 20px auto;
    width: 85%;
">
    {{ error_message }}
</div>
{% endif %}


<!-- header -->
<div class="dashboard-header">
    <h1>
        Welcome, {{ session['user_id'] }}
        ({{ role|capitalize }}) ✈️
    </h1>
    <h3>Airline: {{ airline_name }}</h3>
</div>


<div class="dashboard-sections">

    <!-- upcoming flight -->
    <div class="dashboard-card">
        <h2>Upcoming Flights (Next 30 Days)</h2>

        <!-- flight filter -->
        <form method="post" action="{{ url_for('staff_dashboard') }}" style="margin-bottom: 20px;">

            <label>Start Date:</label>
            <input type="date" name="start_date">

            <label>End Date:</label>
            <input type="date" name="end_date">

            <label>Departure Airport:</label>
            <input name="origin" placeholder="e.g. JFK">

            <label>Arrival Airport:</label>
            <input name="destination" placeholder="e.g. LAX">

            <button class="btn" type="submit" name="form_type" value="flight_filter">
        Apply Filters
            </button>
        </form>

        <div class="table-scroll">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Flight #</th>
                        <th>From</th>
                        <th>To</th>
                        <th>Departure</th>
                        <th>Arrival</th>
                        <th>Status</th>
                        <th>Passengers</th>
                    </tr>
                </thead>
                <tbody>
                    {% if flights %}
                        {% for f in flights %}
                        <tr>
                            <td>{{ f.flight_num }}</td>
                            <td>{{ f.departure_airport }}</td>
                            <td>{{ f.arrival_airport }}</td>
                            <td>{{ f.departure_time }}</td>
                            <td>{{ f.arrival_time }}</td>
                            <td>{{ f.status }}</td>
                            <td>
                                <a class="btn-view"
                                href="{{ url_for('staff_passengers', airline=f.airline_name, flight_num=f.flight_num) }}">
                                 View
                                            </a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="7" style="padding:14px; text-align:center; font-style:italic; color:#666;">
                                No flights found for the selected filters.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>

            </table>
        </div>
    </div>



    <!-- customer history search -->
    <div class="dashboard-card">
        <h2>Customer Flight History</h2>

        <form method="post" action="{{ url_for('staff_customer_history') }}">
            <label>Customer Email:</label>
            <input name="customer_email">
            <button class="btn">View History</button>
        </form>
    </div>



    <!-- analytics -->
    <div class="dashboard-card">
        <h2>Analytics Dashboard</h2>
        <div style="text-align:center;">
            <a class="btn" href="{{ url_for('staff_analytics') }}">View Airline Analytics</a>
        </div>
    </div>




    <!-- admin tools -->
    {% if is_admin %}
    <div class="dashboard-card">
        <h2>Admin Tools</h2>

        <!-- create flight -->
        <h3>Create New Flight</h3>
        <form method="post" action="{{ url_for('staff_create_flight') }}">
            <label>Flight Number:</label>
            <input name="flight_num">

            <label>Departure Airport:</label>
            <input name="departure_airport">

            <label>Arrival Airport:</label>
            <input name="arrival_airport">

            <label>Departure Time (YYYY-MM-DD HH:MM:SS):</label>
            <input name="departure_time">

            <label>Arrival Time:</label>
            <input name="arrival_time">

            <label>Base Price:</label>
            <input name="base_price">

            <label>Airplane ID:</label>
            <input name="airplane_id">

            <button class="btn">Create Flight</button>
        </form>

        <hr>

        <!-- add airplane -->
    
        <h3>Add Airplane</h3>
        <form method="post" action="{{ url_for('staff_add_airplane') }}">
            <label>Airplane ID:</label>
            <input name="airplane_id" required>

            <label>Economy Seat Capacity:</label>
            <input name="economy_capacity" type="number" min="0" required>

            <label>Business Seat Capacity:</label>
            <input name="business_capacity" type="number" min="0" required>

            <label>First Class Seat Capacity:</label>
            <input name="first_capacity" type="number" min="0" required>

            <button class="btn">Add Airplane</button>
        </form>


        <hr>

        <!-- add airport -->
        <h3>Add Airport</h3>
        <form method="post" action="{{ url_for('staff_add_airport') }}">
            <label>Airport Name:</label>
            <input name="airport_name">
            <label>City:</label>
            <input name="airport_city">
            <button class="btn">Add Airport</button>
        </form>

        <hr>

        <!-- authorize agent -->
        <h3>Authorize Booking Agent</h3>
        <form method="post" action="{{ url_for('staff_add_agent_auth') }}">
            <label>Agent Email:</label>
            <input name="agent_email">
            <button class="btn">Authorize Agent</button>
        </form>
    </div>
    {% endif %}



    <!-- Operator tools -->
    {% if is_operator %}
    <div class="dashboard-card">
        <h2>Operator Tools</h2>

        <form method="post" action="{{ url_for('staff_update_status') }}">
            <label>Flight Number:</label>
            <input name="flight_num">

            <label>New Status:</label>
            <select name="status">
                <option value="upcoming">Upcoming</option>
                <option value="in-progress">In Progress</option>
                <option value="delayed">Delayed</option>
            </select>

            <button class="btn">Update Flight Status</button>
        </form>
    </div>
    {% endif %}

</div>

{% endblock %}
